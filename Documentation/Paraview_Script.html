<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="generator" content="scholpandoc">
  <meta name="viewport" content="width=device-width">
  
  <meta name="author" content="Farhad Behafarid, Ganesh Vijayakumar">
  <meta name="dcterms.date" content="2016-06-20">
  <title>Creating paraview scripts for movies</title>
  <style type="text/css">code{white-space: pre;}</style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.js"></script>
  <link rel="stylesheet" href="css/ScholarlyMarkdown-BS3.css">
</head>
<body>
<div class="scholmd-container">
<div class="scholmd-main">
<div class="scholmd-content">
<header>
<h1 class="scholmd-title">Creating paraview scripts for movies</h1>
<div class="scholmd-author">
Farhad Behafarid, Ganesh Vijayakumar
</div>
<div class="scholmd-date">20 June 2016</div>
</header>
<h1 id="save-state">Save state:</h1>
<p>Save Paraview state as “state.py”</p>
<h1 id="add-at-top-of-the-state.py">Add at top of the state.py :</h1>
<pre><code>import sys, glob, commands </code></pre>
<h1 id="flexible-input-files">Flexible input files:</h1>
<p>Change inoput file names (both output files and particle files) so they can be defined as an argument:</p>
<pre><code>out0001000__dat = TecplotReader( guiName=&quot;out-0001000-..dat&quot;, DataArrayStatus=[&#39;u&#39;, &#39;v&#39;, &#39;w&#39;, &#39;P&#39;, &#39;phi&#39;, &#39;node&#39;], FileNames=[&#39;/home/farhad/RUNS/Intestine/8-first-Experiment/2-1st-Experiment-for-Abstract/Case-2-B/out-{}-00001.dat&#39;.format(sys.argv[1])] )
pardat0001000__csv = CSVReader( guiName=&quot;pardat-0001000-..csv&quot;, FileName=[&#39;/home/farhad/RUNS/Intestine/8-first-Experiment/2-1st-Experiment-for-Abstract/Case-2-B/pardat-{}-00001.csv&#39;.format(sys.argv[1])] )</code></pre>
<p>Or using “Replace” option in vim (state.py saved at time step 500 for 2 processors):</p>
<pre><code>:%s/out\-0000500\-00001\.dat&#39;\])/out\-{}\-00001\.dat&#39;\.format(sys\.argv\[1\])\])/g
:%s/out\-0000500\-00002\.dat&#39;\])/out\-{}\-00002\.dat&#39;\.format(sys\.argv\[1\])\])/g

:%s/pardat\-0000600\-00001\.csv&#39;\])/pardat\-{}\-00001\.csv&#39;\.format(sys\.argv\[1\])\])/g</code></pre>
<h1 id="add-at-the-bottom-of-the-state.py">Add at the Bottom of the state.py:</h1>
<pre><code>viewLayout = GetLayout()
WriteImage(&#39;tmp1.png&#39;, view=RenderView1)
WriteImage(&#39;tmp2.png&#39;, view=RenderView2)
WriteImage(&#39;tmp3.png&#39;, view=RenderView3)
WriteImage(&#39;tmp4.png&#39;, view=RenderView4)
commands.getoutput(&quot;convert -border 1x1 +append tmp*.png T{}.jpg&quot;.format(sys.argv[1]))</code></pre>
<p>Note: if one bolus is visualized and for example 4 consecutive sections are desired:</p>
<pre><code>viewLayout = GetLayout()
WriteImage(&#39;tmp1.jpg&#39;, view=RenderView1)
WriteImage(&#39;tmp2.jpg&#39;, view=RenderView3)
commands.getoutput(&quot;convert -border 1x1 +append tmp1.jpg tmp1.jpg tmp1.jpg tmp1.jpg TEMP1.jpg&quot;.format(sys.argv[1]))
commands.getoutput(&quot;convert -border 1x1 +append tmp2.jpg tmp2.jpg tmp2.jpg tmp2.jpg TEMP2.jpg&quot;.format(sys.argv[1]))
commands.getoutput(&quot;convert -border 1x1 -append TEMP* T{}.jpg&quot;.format(sys.argv[1]))</code></pre>
<h1 id="define-the-desired-time-steps">Define the desired time steps:</h1>
<p>Create a file called TimeSteps with all desired steps in one line, separated by “Tab” or “Space”.</p>
<h1 id="create-snapshots">Create snapshots:</h1>
<figure class="scholmd-float scholmd-figure" id="fig:Bash_Loop_pvpython">
<div class="scholmd-float-content"><figure class="scholmd-subfig" style="display: inline-block; width: 40%">
<img src="./Figures/Bash_Loop_pvpython.png" />
</figure></div>
<div class="scholmd-float-caption"><figcaption><span class="scholmd-caption-head"><span class="scholmd-caption-head-prefix">Figure</span><span class="scholmd-caption-head-label">1</span></span></figcaption></div>
</figure>
<h1 id="make-a-movie-out-of-the-snapshots">Make a movie out of the snapshots:</h1>
<pre><code>ffmpeg -framerate 10 -pattern_type glob -i &quot;*.jpg&quot; -vf &quot;fps=25,format=yuv420p&quot; Movie.mp4</code></pre>
<h1 id="scaling-the-movie-size">Scaling the movie size:</h1>
<pre><code>ffmpeg -i Movie.mp4 -s 524x440 -c:a copy Movie_mall.mp4</code></pre>
<h1 id="advanced-creating-plot-snapshots-with-a-moving-time-indicator-line">ADVANCED: Creating Plot snapshots with a moving time indicator line</h1>
<p>in creating the plots, “axvline” option should be used.</p>
<p>An example file called Plot.py can be found below:</p>
<pre><code>import numpy as np
import matplotlib as mpl
mpl.use(&#39;TkAgg&#39;)
import matplotlib.pyplot as plt
import commands
from matplotlib.patches import Ellipse, Polygon
from matplotlib import rc_file
from pylab import loadtxt
from pylab import rcParams
import pickle, sys, os
os.chdir(&#39;../Fasted&#39;)
import Fasted as Case1
os.chdir(&#39;../Plots&#39;)
rcParams[&#39;figure.figsize&#39;] = 12.86, 5
axis_font  = {&#39;fontname&#39;:&#39;Arial&#39;, &#39;size&#39;:&#39;16&#39;}

tcf = 2.6041666666666665E-003 
Cs_mol =0.33000
Cs_gram= 68
alfa= Cs_gram/Cs_mol
IC_solid_drug= alfa * 0.78734  
IT = Case1.IterationNo

for i in IT:
    fig = plt.figure()
    plt.axes([0.13,0.18,0.97-0.13,0.92-0.18])
    plt.plot(Case1.time, Case1.scalarAbsorbtionRate,&#39;-&#39;, color= &#39;blue&#39;, label=&#39;&#39;) 
    plt.grid(b=True, which=&#39;major&#39;,  axis=&#39;y&#39;, linewidth=1)
    plt.ylim(0,6)
    plt.xlim(0,160)
    plt.xlabel(&#39;Time (s)&#39;,**axis_font)
    plt.ylabel(&#39;Drug Absorbtion Rate ($\mu g/s$)&#39;,**axis_font)
    plt.axvline(linewidth=2, color=&#39;red&#39;, x=i*tcf)
    plt.legend(loc=0)
    plt.savefig(&#39;DrugAbsRate-{:07d}.jpg&#39;.format(int(i)),dpi=300)</code></pre>
<p>To create the plot snapshots using plot.py:</p>
<pre><code>for i in `cat Times`; do echo &quot;import Plot&quot; | python ; done</code></pre>
<p>After creating the plot snapshots, use the below command to atttach the plot snapshots to the paraview snapshots:</p>
<pre><code>for i in `cat Times`; do convert ../../&quot;T$i.jpg&quot; &quot;DrugAbsRate-$i.jpg&quot; -append &quot;Viz-Plot-$i.jpg&quot; ; done</code></pre>
<h1 id="make-a-movie-out-of-the-snapshots-1">Make a movie out of the snapshots:</h1>
<pre><code>ffmpeg -framerate 10 -pattern_type glob -i &quot;*.jpg&quot; -vf &quot;fps=25,format=yuv420p&quot; Movie.mp4
ffmpeg -framerate 6  -pattern_type glob -i &quot;*.jpg&quot; -vf &quot;fps=5, format=yuv420p&quot; Movie.mp4 </code></pre>
<div class="references">

</div>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
      processClass: "math"
    },
    TeX: {
        TagSide: "left",
        TagIndent: "1.2em",
        equationNumbers: {
            autoNumber: "AMS"
        },
        Macros: {
            ensuremath: ["#1",1],
            textsf: ["\\mathsf{\\text{#1}}",1],
            texttt: ["\\mathtt{\\text{#1}}",1]
        }
    },
    "HTML-CSS": { 
        scale: 100,
        availableFonts: ["TeX"], 
        preferredFont: "TeX",
        webFont: "TeX",
        imageFont: "TeX",
        EqnChunk: 1000
    }
});
</script>
</div>
</body>
</html>
